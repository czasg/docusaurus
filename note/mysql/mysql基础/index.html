<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/docusaurus/blog/rss.xml" title="Czasg RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docusaurus/blog/atom.xml" title="Czasg Atom Feed"><title data-react-helmet="true">mysql 基础知识 | Czasg</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://czasg.github.io/docusaurus/note/mysql/mysql基础"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-note-current"><meta data-react-helmet="true" property="og:title" content="mysql 基础知识 | Czasg"><meta data-react-helmet="true" name="description" content="MySQL 是 RDBMS（关系型数据库管理系统）应用软件之一，简单点理解，是一个用于存储、管理、访问数据的数据库管理应用。"><meta data-react-helmet="true" property="og:description" content="MySQL 是 RDBMS（关系型数据库管理系统）应用软件之一，简单点理解，是一个用于存储、管理、访问数据的数据库管理应用。"><link data-react-helmet="true" rel="shortcut icon" href="/docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://czasg.github.io/docusaurus/note/mysql/mysql基础"><link data-react-helmet="true" rel="alternate" href="https://czasg.github.io/docusaurus/note/mysql/mysql基础" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://czasg.github.io/docusaurus/note/mysql/mysql基础" hreflang="x-default"><link rel="stylesheet" href="/docusaurus/assets/css/styles.cfdc25de.css">
<link rel="preload" href="/docusaurus/assets/js/runtime~main.4c3cbfb8.js" as="script">
<link rel="preload" href="/docusaurus/assets/js/main.1d57dd81.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus/"><div class="navbar__logo"><img src="/docusaurus/img/logo.svg" alt="Czasg" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/docusaurus/img/logo.svg" alt="Czasg" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Czasg</b></a><a class="navbar__item navbar__link" href="/docusaurus/blog">博客</a><a class="navbar__item navbar__link" href="/docusaurus/note/intro">文档</a><a class="navbar__item navbar__link" href="/docusaurus/author/intro">关于我</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/czasg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌙</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">☀</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus/note/intro">文档计划</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">docker</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">k8s</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">mysql</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus/note/mysql/mysql基础">mysql基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/note/mysql/mysql日志">mysql日志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/note/mysql/mysql索引">mysql索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/note/mysql/mysql锁机制">mysql锁机制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">redis</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">工作通用</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">数据结构与算法</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">毒鸡汤</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">生活知识</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">疑难杂症</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">装机必备</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">部署</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>mysql 基础知识</h1></header><p>MySQL 是 RDBMS（关系型数据库管理系统）应用软件之一，简单点理解，是一个用于存储、管理、访问数据的数据库管理应用。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mysql-基础架构">mysql 基础架构<a aria-hidden="true" class="hash-link" href="#mysql-基础架构" title="Direct link to heading">​</a></h2><p>MySQL 可以分为服务层和存储引擎层两个模块。<br>
<img src="/docusaurus/assets/images/1.1-9fb10cf64788a4aad3403f10a622a5cf.png"><br>
<strong>服务层</strong>：</p><ul><li>连接器：负责与客户端建立连接，获取权限，维持和管理连接。</li><li>查询缓存：对于查询请求，会先到查询缓存查看是否存在缓存，存在则会直接返回。</li><li>分析器：对执行语句做&quot;词法分析&quot;，存在逻辑错误或者资源错误，会在此处抛出异常。</li><li>优化器：当存在索引时，优化器会根据当前表情况，选择最佳的执行方式。</li><li>执行器：调用引擎层接口执行命令。执行前会先检查表的权限。</li></ul><p><strong>存储引擎层</strong>，负责提供数据的存储和提取。其架构模式是插件式的。默认引擎是 InnoDB。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="查询一条语句">查询一条语句<a aria-hidden="true" class="hash-link" href="#查询一条语句" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> ID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在此 sql 中，假设没有索引，那么一次简单的查询流程类似：<br>
<!-- -->1、调用 InnoDB 引擎接口获取 table 表的第一行数据，判断 ID 是否等于 10，如果是则将这行数据存储在结果集中，不是则跳过。
2、调用 InnoDB 引擎接口获取下一行，重复判断并执行，直至表数据全部执行完。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="更新一条语句">更新一条语句<a aria-hidden="true" class="hash-link" href="#更新一条语句" title="Direct link to heading">​</a></h2><p>更新流程和查询流程不一样，还涉及到日志模块：<strong>redo log</strong>（重做日志） 和 <strong>binlog</strong>（归档日志）。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="redo-log">redo log<a aria-hidden="true" class="hash-link" href="#redo-log" title="Direct link to heading">​</a></h4><p>redo log 是 InnoDB 特有的一种日志。<br>
<!-- -->它其实是我们常说的 WAL（Write-Ahead Logging）预写日志的一种实现，即先写日志，再写磁盘。<br>
<!-- -->具体来说就是，InnoDB 会先把日志记录写到 redo log 中，然后更新内存，此时就算完成了更新。<br>
<!-- -->后续 InnoDB 引擎会再适当的时候，将这个操作记录刷新到磁盘里。这种一般是再系统比较空闲的时候。<br>
<!-- -->通过 redo log，InnoDB 引擎也实现了 crash-safe 能力。</p><p>redo log 的核心是节省<strong>随机写磁盘的IO损耗</strong>。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="binlog">binlog<a aria-hidden="true" class="hash-link" href="#binlog" title="Direct link to heading">​</a></h4><p>和 redo log 这类引擎日志不同，binlog 是服务层的日志。为什么会有两份日志呢。<br>
<!-- -->因为最初 mysql 默认引擎是 MyISAM，他没有 crash-safe 的能力，后面的 InnoDB 引擎对此进行了补充。</p><p>这两种日志有一定的区别：<br>
<!-- -->1、redo log 是引擎特有的日志。binlog 是 mysql 服务层实现的，所有引擎都可以记录。<br>
<!-- -->2、redo log 是物理日志，记录的是再某个数据页上做出了什么修改。binlog 是逻辑日志，记录的是语句的原始逻辑。类似：&quot;给ID为2的c字段加一&quot;<br>
<!-- -->3、redo log 是循环写，binlog 是追加写。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> ID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>再此 sql 中，假设有主键索引，那么一次简单的更新流程类似：<br>
<!-- -->1、执行器先找到 ID 为 2 的这一行数据。当 ID 是主键时，引擎可以直接通过索引找到这一行。如果 ID 为 2 的这一行数据就在内存中，则直接返回。否则需要先从磁盘读入内存，然后再返回。<br>
<!-- -->2、执行器拿到引擎返回的数据，把对应字段的值加上一。这样就得到了一行新数据，然后再调用引擎写入这行新数据。<br>
<!-- -->3、引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 中。此时 redo log 处于 prepare 状态。然后响应执行器。<br>
<!-- -->4、执行器将这个操作生成 binlog，并写入磁盘。<br>
<!-- -->5、执行器调用引擎提交事务的接口，引擎将 redo log 的状态改为 commit 状态即可，一次更新事务就完成了。</p><p>最后几步关于 redo log 的状态的处理，属于<strong>两阶段提交</strong>。<br>
<!-- -->这是为了更好的应对 crash 场景：</p><ul><li>先写 redo log 再写 binlog：当 redo log 写完，binlog 还没写，此时 crash。那么恢复后的数据，就没有记录到 binlog 中。</li><li>先写 binlog 再写 redo log：当 binlog 写完后 crash，此时恢复后的数据，相较于原始数据，会多出来一部分操作。
如果没有两阶段提交，那么crash恢复后的场景，可能会出现恢复前后状态不一致的场景。</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="事务">事务<a aria-hidden="true" class="hash-link" href="#事务" title="Direct link to heading">​</a></h2><p>说到事务，我们肯定会想到：ACID（原子性，一致性，隔离性，持久性），这也是事务的一些特点。<br>
<!-- -->在数据库中，事务是要保证一组数据库操作，要么全部成功，要么全部不成功。<br>
<!-- -->事务是由引擎实现的，比如 InnoDB 支持事务而 MyISAM 不支持事务，这也是 MyISAM 被取代的重要原因之一。    </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="隔离级别">隔离级别<a aria-hidden="true" class="hash-link" href="#隔离级别" title="Direct link to heading">​</a></h4><p>数据库中有多个事务同时执行时，会出现：<strong>脏读</strong>、<strong>不可重复度</strong>、<strong>幻读</strong>等问题。<br>
<!-- -->为了解决这些问题，就有了<strong>隔离级别</strong>的概念。</p><p>隔离级别有：   </p><ul><li>read uncommitted：读未提交，一个事务未提交时，它的变更就已经可以被其他事务看到。</li><li>read committed：读已提交，一个事务提交后，它的变更才能被其他事务看到。</li><li>repeatable read：可重复读，一个事务在执行过程中看到的数据，总是和事务启动时看到的数据是一致的。</li><li>serializable：串行化，严格按照先后顺序执行事务。</li></ul><p>在实现上，数据库会在命令执行期间创建视图，访问的时候以视图的逻辑结果为准。<br>
<!-- -->在读未提交隔离级别，没有视图概念，直接返回当前记录的最新值。<br>
<!-- -->在读提交隔离级别，视图是在每个 sql 开始执行的时候创建的。<br>
<!-- -->在可重复读隔离级别，视图是在事务启动的时候创建，整个事务期间都在使用这个视图。<br>
<!-- -->在串行化隔离级别，则直接通过加锁的方式来避免并行访问。   </p><p>视图是基于<strong>多版本并发控制（MVCC）</strong>实现的。<br>
<!-- -->例如可重复读隔离级别下的事务，在执行时会申请唯一的版本号，以这个版本号作为视图，可以避免其他事务的影响。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="视图">视图<a aria-hidden="true" class="hash-link" href="#视图" title="Direct link to heading">​</a></h4><p>在数据库中，即使有上百G的数据，事务也可以一瞬间启动。而且启动事务的时候会生成视图，那为什么会这么快呢？</p><p>事务的原理是启动时生成一个唯一的事务ID（transaction id）。而在数据库中，每行数据也都是有版本的。<br>
<!-- -->每次事务更新时，都会生成对应版本的数据，并且把事务ID赋予这个数据版本，计为 row_trx_id。<br>
<!-- -->所以即使只有一行数据，也可能存在多个版本。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus/note/k8s/service"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Service</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus/note/mysql/mysql日志"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">mysql日志<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mysql-基础架构" class="table-of-contents__link toc-highlight">mysql 基础架构</a></li><li><a href="#查询一条语句" class="table-of-contents__link toc-highlight">查询一条语句</a></li><li><a href="#更新一条语句" class="table-of-contents__link toc-highlight">更新一条语句</a></li><li><a href="#事务" class="table-of-contents__link toc-highlight">事务</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Czasg's Site.</div></div></div></footer></div>
<script src="/docusaurus/assets/js/runtime~main.4c3cbfb8.js"></script>
<script src="/docusaurus/assets/js/main.1d57dd81.js"></script>
</body>
</html>