---
title: 异常排查
---

### 代码中遇到进程阻塞，进程僵死，内存泄漏等情况怎么排查
排查进程阻塞、僵死和内存泄漏等问题是调试和性能优化的关键步骤。以下是一些常见的排查方法：

#### 进程阻塞：

1. **使用工具分析：** 使用系统工具如 `top`, `htop`, `ps`, `iostat` 等，检查系统资源的使用情况，查看是否有进程占用过多的 CPU 或者阻塞了其他资源。

2. **查看进程状态：** 使用 `ps` 命令查看进程状态。如果进程状态是 `D`（不可中断的睡眠状态），则表示进程正在等待某些资源，可以通过 `strace` 或 `dtrace` 等工具来追踪系统调用，找到进程在等待哪个资源。

3. **分析日志：** 查看系统和应用程序的日志文件，特别关注与阻塞相关的信息，例如网络请求超时、锁竞争等。

#### 进程僵死：

1. **检查进程状态：** 使用 `ps` 命令查看进程状态。如果进程状态是 `Z`（僵死状态），则表示进程已经终止但父进程还没有回收它的资源。查看父进程是否正常运行，如果父进程也终止了，那么可能是僵死进程的原因。

2. **查看子进程状态：** 如果可能，查看父进程的代码，确保它正常地回收子进程。

#### 内存泄漏：

1. **使用工具检测：** 使用工具如 Valgrind、AddressSanitizer、Heap Profiler 等，对程序进行内存检测。这些工具可以帮助找到内存泄漏和错误的地方。

2. **分析代码：** 仔细检查代码，特别是动态分配内存的地方，确保每次分配的内存都被正确释放。使用 RAII（资源获取即初始化）等技术可以帮助自动管理资源。

3. **检查循环引用：** 如果使用了循环引用的数据结构，可能会导致内存泄漏。确保在不再需要时解除循环引用。

4. **监控内存使用：** 使用系统工具或应用程序自身的监控机制，定期检查内存使用情况，查看是否有明显的内存泄漏迹象。

5. **分析核心转储：** 如果程序崩溃，生成了核心转储文件，可以使用工具如 GDB 来分析转储文件，查看内存状态和调用栈。

在排查问题时，结合多个方法使用，对于进程阻塞和僵死问题，重点在于查看进程状态和分析相关日志；对于内存泄漏问题，工具的使用和代码审查都是关键。