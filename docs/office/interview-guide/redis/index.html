<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-office docs-doc-id-interview-guide/redis">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Redis 题库 | Czasg</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://czasg.github.io/docusaurus/docs/office/interview-guide/redis"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-office-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-office-current"><meta data-rh="true" property="og:title" content="Redis 题库 | Czasg"><meta data-rh="true" name="description" content="Redis Question Bank😂"><meta data-rh="true" property="og:description" content="Redis Question Bank😂"><link data-rh="true" rel="icon" href="/docusaurus/img/dd.ico"><link data-rh="true" rel="canonical" href="https://czasg.github.io/docusaurus/docs/office/interview-guide/redis"><link data-rh="true" rel="alternate" href="https://czasg.github.io/docusaurus/docs/office/interview-guide/redis" hreflang="en"><link data-rh="true" rel="alternate" href="https://czasg.github.io/docusaurus/docs/office/interview-guide/redis" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docusaurus/blog/rss.xml" title="Czasg RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docusaurus/blog/atom.xml" title="Czasg Atom Feed"><link rel="stylesheet" href="/docusaurus/assets/css/styles.7702a43a.css">
<link rel="preload" href="/docusaurus/assets/js/runtime~main.942897e7.js" as="script">
<link rel="preload" href="/docusaurus/assets/js/main.73c56d5a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus/"><div class="navbar__logo"><img src="/docusaurus/img/dd.ico" alt="Czasg" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docusaurus/img/dd.ico" alt="Czasg" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Czasg</b></a><a class="navbar__item navbar__link" href="/docusaurus/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docusaurus/docs/develop">技术类</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docusaurus/docs/office">职场类</a></li><li><a class="dropdown__link" href="/docusaurus/docs/daily-life">生活类</a></li><li><a class="dropdown__link" href="/docusaurus/docs/book">书籍类</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a href="https://chat.openai.com/chat" target="_blank" rel="noopener noreferrer" class="dropdown__link">ChatGPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mholt.github.io/json-to-go" target="_blank" rel="noopener noreferrer" class="dropdown__link">Json2Go<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://crop-circle.imageonline.co/cn/" target="_blank" rel="noopener noreferrer" class="dropdown__link">圆图剪切<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.dute.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">在线工具<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/docusaurus/emoji">emoji</a></li></ul></div><a class="navbar__item navbar__link" href="/docusaurus/about-me">关于我</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/docusaurus/"><img src="/docusaurus/img/dd.ico" alt="Czasg" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docusaurus/img/dd.ico" alt="Czasg" class="themedImage_ToTc themedImage--dark_i4oU"><b>Czasg</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus/docs/office/">文档介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docusaurus/docs/office/interview-guide/">面试题库</a><button aria-label="Toggle the collapsible sidebar category &#x27;面试题库&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/base-computer">基础题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/golang">Go 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/python">Python 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/mysql">MySQL 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus/docs/office/interview-guide/redis">Redis 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/rabbitmq">RabbitMQ 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/kafka">Kafka 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/docker">Docker 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/k8s">K8S 题库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/backend">后端基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/backend">场景题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/docs/office/interview-guide/network-safe">网络安全</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docusaurus/docs/office/recruit-guide/">招聘指南</a><button aria-label="Toggle the collapsible sidebar category &#x27;招聘指南&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docusaurus/docs/office/interview-guide/"><span itemprop="name">面试题库</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Redis 题库</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Redis 题库</h1></header><p>Redis（Remote Dictionary Server）是一种开源的内存数据存储系统，它可以用作数据库、缓存和消息中间件。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基础概念">基础概念<a href="#基础概念" class="hash-link" aria-label="Direct link to 基础概念" title="Direct link to 基础概念">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么说redis是单线程服务">为什么说redis是单线程服务<a href="#为什么说redis是单线程服务" class="hash-link" aria-label="Direct link to 为什么说redis是单线程服务" title="Direct link to 为什么说redis是单线程服务">​</a></h3><p>Redis不是严格意义上的单线程服务。这里的单线程，主要是指redis的核心执行（网络I/O、键值对读写）是单线程完成的。</p><p>类似持久化、数据同步等、还是由其他线程执行。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis60为什么要引入多线程">Redis6.0为什么要引入多线程<a href="#redis60为什么要引入多线程" class="hash-link" aria-label="Direct link to Redis6.0为什么要引入多线程" title="Direct link to Redis6.0为什么要引入多线程">​</a></h3><p>Redis6.0在网络IO模块支持多线程，核心键值对读写仍然是单线程。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis单线程为什么性能这么好">Redis单线程为什么性能这么好<a href="#redis单线程为什么性能这么好" class="hash-link" aria-label="Direct link to Redis单线程为什么性能这么好" title="Direct link to Redis单线程为什么性能这么好">​</a></h3><ol><li>基于<strong>内存的数据库</strong>，相比于传统的数据库，在性能上具有天然的优势。</li><li>核心执行引擎是单线程，在高并发场景下避免了锁竞争。</li><li>通过<strong>事件驱动模型</strong>和<strong>IO多路复用</strong>，实现客户端请求、网络IO的高效处理。</li><li>高效的数据结构和算法，如：哈希表、跳表等。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="事件驱动模型">事件驱动模型<a href="#事件驱动模型" class="hash-link" aria-label="Direct link to 事件驱动模型" title="Direct link to 事件驱动模型">​</a></h3><p>事件驱动模型是一种<strong>异步编程模型</strong>。这种模型基于事件循环来执行，也就是通过监听和响应事件来处理输入和输出。</p><p>在Redis的主线程中，运行着一个事件循环。该<code>EventLoop</code>不断地监听和处理发生的事件，如新的客户端连接、数据可读或可写等。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="优点">优点<a href="#优点" class="hash-link" aria-label="Direct link to 优点" title="Direct link to 优点">​</a></h4><p>相比于多线程、多进程模型来说，事件驱动模型避免了为每一个请求创建一个线程甚至进程，因此事件驱动模型可以轻松处理大量并大请求。
且不会存在系统调度开销。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="缺点">缺点<a href="#缺点" class="hash-link" aria-label="Direct link to 缺点" title="Direct link to 缺点">​</a></h4><ol><li>事件驱动模型更适合I/O密集型任务，对于计算密集型任务，不如多线程、多进程模型。</li><li>一旦发生阻塞，会影响整个事件循环</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="io多路复用">IO多路复用<a href="#io多路复用" class="hash-link" aria-label="Direct link to IO多路复用" title="Direct link to IO多路复用">​</a></h3><p>I/O多路复用是一种操作系统提供的机制，允许单个进程或线程同时监听多个I/O通道的状态，以确定哪个通道有数据可读或可写。这使得程序能够有效地处理多个I/O操作，而不需要为每个I/O通道创建一个独立的线程。主要的I/O多路复用机制包括<code>select</code>、<code>poll</code>和<code>epoll</code>。</p><p><code>select</code>是一种传统的I/O多路复用机制，最早出现在Unix系统中。它的工作方式是通过一个文件描述符集合，检查每个文件描述符的状态（可读、可写等）。主要的特点包括：</p><ul><li><strong>阻塞调用：</strong> 当没有任何文件描述符就绪时，<code>select</code>调用会阻塞，等待至少有一个文件描述符就绪。</li><li><strong>文件描述符数量限制：</strong> 通常有一个限制，例如1024个文件描述符。</li><li><strong>轮询开销：</strong> <code>select</code>采用轮询的方式检查文件描述符的状态，可能会带来一些开销。</li></ul><p><code>poll</code>是对<code>select</code>的改进，同样用于多路复用I/O。它的一些特点包括：</p><ul><li><strong>无文件描述符数量限制：</strong> <code>poll</code>没有<code>select</code>的文件描述符数量限制。</li><li><strong>阻塞调用：</strong> 与<code>select</code>类似，当没有文件描述符就绪时，<code>poll</code>调用也会阻塞。</li><li><strong>逐个扫描：</strong> <code>poll</code>通过逐个扫描文件描述符，找出就绪的文件描述符。</li></ul><p><code>epoll</code>是在Linux系统上引入的新一代I/O多路复用机制，相对于<code>select</code>和<code>poll</code>有更高的性能。它的一些特点包括：</p><ul><li><strong>无文件描述符数量限制：</strong> <code>epoll</code>也没有文件描述符数量的限制，可以处理数以万计的并发连接。</li><li><strong>事件驱动：</strong> <code>epoll</code>是事件驱动的，只在有事件发生时进行处理，而不是通过轮询来检查。</li><li><strong>支持Edge Triggered（ET）模式：</strong> 在ET模式下，只有在状态变化时才会触发事件，而不是像Level Triggered（LT）模式那样持续通知。</li><li><strong>更高的性能：</strong> 由于采用了事件驱动和其他一些优化，<code>epoll</code>在处理大量并发连接时表现更好。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis数据类型">Redis数据类型<a href="#redis数据类型" class="hash-link" aria-label="Direct link to Redis数据类型" title="Direct link to Redis数据类型">​</a></h3><ol><li><p><strong>字符串（String）：</strong></p><ul><li><strong>简介：</strong> 字符串是Redis最简单的数据类型，可以包含任意类型的数据，包括文本和二进制数据。</li><li><strong>用途：</strong> 通常用于存储简单的键值对数据，也可用于缓存和计数器等场景。</li><li><strong>数据结构</strong>：简单动态字符串类型<ul><li>整数：采用int编码，元数据8字节+int8字节，共计16字节</li><li>长度小于44：采用紧凑型编码。</li><li>长度大于44：采用指针。</li></ul></li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SET mykey &quot;Hello&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GET mykey</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>哈希（Hash）：</strong></p><ul><li><strong>简介：</strong> 哈希是一个键值对集合，每个哈希可以存储多个字段和对应的值，类似于关联数组。</li><li><strong>用途：</strong> 适合存储对象，如用户信息、配置项等，便于按字段进行读写操作。</li><li><strong>数据结构</strong>：<ul><li>哈希表</li><li>压缩列表</li></ul></li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">HSET user:1000 username &quot;john_doe&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">HGET user:1000 username</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>列表（List）：</strong></p><ul><li><strong>简介：</strong> 列表是一个有序的字符串元素集合，支持在两端执行插入和删除操作。</li><li><strong>用途：</strong> 适用于队列、栈等数据结构，可按顺序存储多个元素。</li><li><strong>数据结构</strong>：<ul><li>双向链表</li><li>压缩列表</li></ul></li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">LPUSH mylist &quot;item1&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">RPUSH mylist &quot;item2&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">LRANGE mylist 0 -1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>集合（Set）：</strong></p><ul><li><strong>简介：</strong> 集合是一个无序的字符串元素集合，元素是唯一的。</li><li><strong>用途：</strong> 适用于存储唯一值，如用户标签、好友关系等。</li><li><strong>数据结构</strong>：<ul><li>哈希表</li><li>整数数组</li></ul></li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SADD myset &quot;value1&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SADD myset &quot;value2&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SMEMBERS myset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>有序集合（Sorted Set）：</strong></p><ul><li><strong>简介：</strong> 有序集合是集合的扩展，每个元素都有一个分数，可以按升序或降序排列。</li><li><strong>用途：</strong> 适用于需要排序的场景，如排行榜。</li><li><strong>数据结构</strong>：<ul><li>跳表</li><li>压缩列表</li></ul></li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ZADD myzset 1 &quot;value1&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ZADD myzset 2 &quot;value2&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ZRANGE myzset 0 -1 WITHSCORES</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>位图（Bitmap）：</strong></p><ul><li><strong>简介：</strong> 位图是一种特殊的字符串，可进行位操作，常用于存储和处理状态信息。</li><li><strong>用途：</strong> 例如用户在线状态、签到记录等。</li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SETBIT mybitmap 0 1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GETBIT mybitmap 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>HyperLogLog：</strong></p><ul><li><strong>简介：</strong> HyperLogLog是一种基数估算算法，用于估计集合中不同元素的数量，具有固定的空间复杂度。</li><li><strong>用途：</strong> 适用于估算大规模数据集合的基数，如网站访问用户数。</li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">PFADD myhyperloglog element1 element2 element3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">PFCOUNT myhyperloglog</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><strong>Geo（地理空间）：</strong></p><ul><li><strong>简介：</strong> Geo是用于处理地理空间信息的数据类型，主要用于存储地理位置坐标。</li><li><strong>用途：</strong> 适用于实现位置相关的应用，如附近的商家、地点推荐等。</li><li><strong>命令示例：</strong><div class="language-redis codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-redis codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">GEOADD mylocations 13.361389 38.115556 &quot;Palermo&quot; 15.087269 37.502669 &quot;Catania&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="哈希表底层原理">哈希表底层原理<a href="#哈希表底层原理" class="hash-link" aria-label="Direct link to 哈希表底层原理" title="Direct link to 哈希表底层原理">​</a></h3><p>哈希表底层是基于数组实现的。数组中每一个元素我们称之为哈希桶。当发生键值对操作时，首先对key值进行哈希运算，
并将哈希唯一映射到某一个哈希桶中。因此，哈希表可以实现一个近似O(1)的操作。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis与memcached区别">Redis与Memcached区别<a href="#redis与memcached区别" class="hash-link" aria-label="Direct link to Redis与Memcached区别" title="Direct link to Redis与Memcached区别">​</a></h3><ul><li>Redis拥有更丰富的我数据结构，支持持久化、淘汰、事务、集群等功能</li><li>Memcached仅支持键值对缓存</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内存淘汰策略">内存淘汰策略<a href="#内存淘汰策略" class="hash-link" aria-label="Direct link to 内存淘汰策略" title="Direct link to 内存淘汰策略">​</a></h3><ol><li><strong>No Eviction (无淘汰策略):</strong><ul><li>如果配置为无淘汰策略，当内存超过限制时，Redis会拒绝写入操作，直到足够的内存被释放为止。这样可以确保不会删除任何数据，但也可能导致服务不可用。</li></ul></li><li><strong>All Keys Random (随机淘汰):</strong><ul><li>这种策略会从所有的键中随机选择一些进行淘汰。虽然简单，但可能导致一些热门的数据被删除，从而影响性能。</li></ul></li><li><strong>Volatitle TTL (根据TTL淘汰):</strong><ul><li>在这种策略中，Redis会优先淘汰具有较短TTL（生存时间）的键。这样做可以确保首先删除那些很快就会过期的数据，腾出空间来存储新的数据。</li></ul></li><li><strong>Least Recently Used (LRU - 最近最少使用):</strong><ul><li>LRU算法会根据最近访问的时间来淘汰最少使用的键。当内存不足时，选择最近最少使用的键进行淘汰。这通常是一个比较有效的策略，因为一般而言，很少被访问的键可能很久没有使用过，有可能不再需要。</li></ul></li><li><strong>Least Frequently Used (LFU - 最不经常使用):</strong><ul><li>LFU算法会根据键被访问的频率来淘汰最不经常使用的键。具有较低访问频率的键会被优先淘汰。</li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="除了缓存还有那些应用场景">除了缓存还有那些应用场景<a href="#除了缓存还有那些应用场景" class="hash-link" aria-label="Direct link to 除了缓存还有那些应用场景" title="Direct link to 除了缓存还有那些应用场景">​</a></h3><ul><li>缓存</li><li>分布式锁</li><li>消息队列</li><li>布隆过滤器</li><li>排行榜</li><li>秒杀场景</li></ul><br><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="缓存">缓存<a href="#缓存" class="hash-link" aria-label="Direct link to 缓存" title="Direct link to 缓存">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是缓存击穿缓存穿透缓存雪崩缓存预热">什么是缓存击穿、缓存穿透、缓存雪崩、缓存预热<a href="#什么是缓存击穿缓存穿透缓存雪崩缓存预热" class="hash-link" aria-label="Direct link to 什么是缓存击穿、缓存穿透、缓存雪崩、缓存预热" title="Direct link to 什么是缓存击穿、缓存穿透、缓存雪崩、缓存预热">​</a></h3><ol><li><strong>缓存击穿</strong>：指的是在高并发的情况下，缓存中的某个热点数据突然过期或被删除，导致大量请求直接穿透缓存，同时请求数据库获取数据，给数据库造成巨大压力，可能导致数据库崩溃。<ul><li>预防策略：热点数据不设置过期，由程序自己维护</li></ul></li><li><strong>缓存穿透</strong>：指的是请求的数据在缓存和数据库中都不存在，导致每次请求都直接穿透缓存，请求数据库获取数据。这种情况可能是由于恶意攻击或请求了不存在的数据导致的。<ul><li>预防策略：查询未命中也是用缓存，或者使用布隆过滤</li></ul></li><li><strong>缓存雪崩</strong>：指的是缓存中大量的数据同时过期或失效，导致大量请求直接穿透缓存，同时请求数据库获取数据，给数据库造成巨大压力，可能导致数据库崩溃。<ul><li>预防策略：过期时间增加随机值，热点数据不设置过期时间 </li></ul></li><li><strong>缓存预热</strong>：指的是在缓存系统启动或更新缓存数据时，提前将热点数据加载到缓存中，以便在请求到来时能够直接从缓存中获取数据，减少对数据库的请求压力。缓存预热可以提高缓存的命中率，减少数据库的负载。</li></ol><br><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="持久化">持久化<a href="#持久化" class="hash-link" aria-label="Direct link to 持久化" title="Direct link to 持久化">​</a></h2><p>Redis 使用两种主要的持久化机制，分别是 Append-Only File (AOF) 和 Redis DataBase (RDB)。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aofappend-only-file">AOF（Append-Only File）<a href="#aofappend-only-file" class="hash-link" aria-label="Direct link to AOF（Append-Only File）" title="Direct link to AOF（Append-Only File）">​</a></h3><ul><li><strong>工作原理：</strong> AOF 记录了所有写操作。当Redis重新启动时，会通过回放AOF文件中的写操作，实现数据还原。</li><li><strong>写回策略：</strong><ul><li><strong>Always</strong>：同步写回</li><li><strong>Everysec</strong>：每秒一次，将缓冲区数据刷新到磁盘</li><li><strong>No</strong>：由操作系统控制写回。</li></ul></li><li><strong>优点：</strong><ul><li><strong>数据相对可靠</strong>，持久化过程中，数据基本上是实时写入的，因此对数据的损失较小。</li><li><strong>可配置性</strong>，AOF 持久化提供了一些可配置的选项，例如<code>appendfsync</code>策略，可以控制 AOF 文件的同步策略。你可以根据对数据一致性和性能的要求进行调整。</li></ul></li><li><strong>缺点：</strong><ul><li><strong>性能影响</strong>：AOF 持久化会对 Redis 的性能产生一定影响，因为每次写操作都需要写入磁盘。这可能会导致写入性能下降，尤其是在高负载的情况下。</li><li><strong>文件大小</strong>：随着时间的推移，AOF 文件可能会变得非常大。为了避免文件过大，Redis 提供了 AOF 文件自动重写功能，但这仍然需要一定的计算资源。</li><li><strong>恢复时间</strong>：在启动时，Redis 需要加载并执行 AOF 文件中的所有命令，这可能需要一些时间，特别是对于大型的 AOF 文件。</li></ul></li><li><strong>FAQ：</strong><ul><li><strong>AOF 文件过大如何处理</strong>：通过 <code>BGREWRITEAOF</code> 指令来重写AOF日志。其原理就是将同一个key的操作合并。</li><li><strong>AOF 重写是否会阻塞 redis</strong>：重写由后台线程完成，不会阻塞主线程</li><li><strong>AOF 重写期间新的写操作如何保存</strong>：新的写操作会先暂存到重写缓冲区，等重写完成后再追加。</li></ul></li></ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">AOF持久化配置</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">appendonly yes</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">appendfilename &quot;appendonly.aof&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">appendfsync everysec</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 当 AOF 文件的大小超过上一次重写后大小的 100%（即增长了一倍），或者 AOF 文件达到 64MB 时，</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Redis 会自动触发 AOF 文件重写操作，以优化文件大小并减少历史命令的数量。</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">auto-aof-rewrite-percentage 100</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">auto-aof-rewrite-min-size 64mb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rdbredis-database">RDB（Redis DataBase）<a href="#rdbredis-database" class="hash-link" aria-label="Direct link to RDB（Redis DataBase）" title="Direct link to RDB（Redis DataBase）">​</a></h3><ul><li><strong>工作原理：</strong> RDB 是一种快照机制，记录某一时刻的全量数据。</li><li><strong>同步策略</strong>：<ul><li><strong>save</strong>：阻塞主线程</li><li><strong>bgsave</strong>：不阻塞主线程</li></ul></li><li><strong>优点：</strong><ul><li><strong>数据紧凑</strong>：RDB 文件相对较小，它是一个二进制文件，它存储了 Redis 服务器的整个数据集。</li><li><strong>恢复速度块</strong>：恢复速度比 AOF 快，因为只需加载一个文件即可。</li></ul></li><li><strong>缺点：</strong><ul><li><strong>数据相对不可靠</strong>：RDB是某一个时间全量数据的快照，是定期执行的。对于快照之后的数据不会保存。因此可能造成数据大量不一致。</li><li><strong>性能影响</strong>：在数据量较大时，生成 RDB 文件可能会影响 Redis 的性能。</li></ul></li></ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">RDB持久化配置</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 配置 RDB 文件的保存路径</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">dir /path/to/redis/rdb</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 配置 RDB 文件的文件名</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">dbfilename dump.rdb</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 配置 RDB 文件的保存条件</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 在 900 秒内有 1 个键发生变化时，将进行 RDB 持久化；</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 在 300 秒内有 10 个键发生变化时，将进行 RDB 持久化；</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 在 60 秒内有 10000 个键发生变化时，将进行 RDB 持久化。</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">save 900 1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">save 300 10</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">save 60 10000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="如何选择合适的持久化方式">如何选择合适的持久化方式<a href="#如何选择合适的持久化方式" class="hash-link" aria-label="Direct link to 如何选择合适的持久化方式" title="Direct link to 如何选择合适的持久化方式">​</a></h3><p>选择合适的 Redis 持久化方式取决于业务需求和使用场景</p><ol><li>数据重要性：如果您的数据非常重要，不能丢失，那么您可能需要选择 AOF 持久化方式。AOF 持久化方式会将每个写入操作记录到日志文件中，因此即使 Redis 服务器崩溃，也可以通过重新加载 AOF 文件来恢复数据。</li><li>数据恢复速度：如果您需要快速恢复数据，那么您可能需要选择 RDB 持久化方式。RDB 持久化方式会将 Redis 服务器的整个内存数据快照保存到磁盘中，因此恢复数据的速度非常快。</li><li>数据一致性：如果您需要更高的数据一致性，那么您可能需要选择 AOF 持久化方式。AOF 持久化方式会记录每个写入操作，因此可以保证数据的一致性。</li><li>性能影响：AOF 持久化方式可能会对 Redis 服务器的性能产生一定的影响，因为它需要将每个写入操作记录到日志文件中。相比之下，RDB 持久化方式对性能的影响较小，因为它只需要在特定的时间点生成数据快照。</li><li>数据大小：如果您的 Redis 服务器存储的数据量非常大，那么您可能需要选择 RDB 持久化方式。RDB 持久化方式可以生成紧凑的二进制文件，因此可以节省磁盘空间。</li></ol><br><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="集群">集群<a href="#集群" class="hash-link" aria-label="Direct link to 集群" title="Direct link to 集群">​</a></h2><p>Redis 集群是用于解决单点瓶颈的一种方案。主要包括：Redis <strong>主从集群</strong>（Redis Sentinel）和<strong>切片集群</strong>（Redis Cluster）。</p><p>其中，主从集群更适合于需要数据高可用性和读性能优化的场景，而切片集群更适合于需要水平扩展和处理大量数据的场景。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主从集群">主从集群<a href="#主从集群" class="hash-link" aria-label="Direct link to 主从集群" title="Direct link to 主从集群">​</a></h3><p>Redis 主从集群：也就是我们常说的主备，是一个包含一个主节点（Master）和多个从节点（Slave）的架构。主节点负责处理所有的写操作，并将数据同步到从节点。从节点用于提供数据副本，并在主节点发生故障时进行故障转移。</p><p>在主从集群中，客户端可以连接到主节点或从节点进行数据读写操作。主节点和从节点之间通过复制协议保持数据一致性。当主节点发生故障时，Sentinel 会监测到并自动将一个从节点提升为主节点，以确保缓存系统的正常运行。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="优点-1">优点<a href="#优点-1" class="hash-link" aria-label="Direct link to 优点" title="Direct link to 优点">​</a></h4><ul><li><strong>高可用性</strong>：主从集群通过主节点和从节点的复制机制，提供了数据的冗余备份，当主节点发生故障时，从节点可以快速提升为主节点，确保缓存系统的正常运行。</li><li><strong>高性能</strong>：主从集群是读写分离的，主库负责写，从库负责读。通过水平拓展从节点，可以提供更高的并发性能。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="缺点-1">缺点<a href="#缺点-1" class="hash-link" aria-label="Direct link to 缺点" title="Direct link to 缺点">​</a></h4><ul><li><strong>主节点性能瓶颈</strong>：主节点负责处理所有的写操作，因此在高负载情况下可能成为性能瓶颈。</li><li><strong>数据延迟</strong>：主从集群中，从节点的数据是通过主节点复制而来的，因此可能存在一定的数据延迟。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="同步架构">同步架构<a href="#同步架构" class="hash-link" aria-label="Direct link to 同步架构" title="Direct link to 同步架构">​</a></h4><ul><li>主-从架构</li><li>主-从-从架构：过多的从库直接从主库获取数据，会对主库造成一定的压力，因此可以将压力以联级的方式传输到从库点上。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主从复制">主从复制<a href="#主从复制" class="hash-link" aria-label="Direct link to 主从复制" title="Direct link to 主从复制">​</a></h3><p>Redis 的主从复制是指将主节点（Master）的数据同步到从节点（Slave）的过程。通过主从复制，可以实现数据的冗余备份，提高缓存系统的可用性和可靠性。</p><p>主从复制的逻辑如下：</p><ol><li>建立连接：从节点与主节点建立连接，并发送复制请求。</li><li>全量同步：主节点将整个数据库的内容发送给从节点，完成数据的初始同步。</li><li>增量同步：在全量同步完成后，主节点会将后续的写操作以命令的形式发送给从节点，从节点执行这些命令，完成数据的实时同步。</li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="增量复制">增量复制<a href="#增量复制" class="hash-link" aria-label="Direct link to 增量复制" title="Direct link to 增量复制">​</a></h4><p>在 redis2.8 以前，当主从节点之间因网络问题断开后，重新建立连接时，主从之间会重新执行一次全量复制。</p><p>在 redis2.8 之后，支持增量复制。
在增量复制过程中，主节点会维护一个复制偏移量（replication offset），用于记录主节点已经发送给从节点的数据量。当主从节点之间的连接断开后，从节点会记录最后一次接收到的复制偏移量。</p><p>当主从节点重新建立连接时，从节点会向主节点发送自己记录的复制偏移量。主节点会根据从节点的复制偏移量，判断从节点是否已经接收了全部数据。如果从节点的复制偏移量小于主节点的当前偏移量，则主节点会将从节点的复制偏移量之后的数据发送给从节点，完成增量同步。</p><p>通过复制偏移量的机制，Redis 的主从复制可以在网络问题导致连接断开后，快速恢复数据同步，避免了全量同步的开销，提高了复制的效率和可靠性。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="从库读到过期数据">从库读到过期数据<a href="#从库读到过期数据" class="hash-link" aria-label="Direct link to 从库读到过期数据" title="Direct link to 从库读到过期数据">​</a></h4><p>设置过期尽量使用 expireat 而不是 expire</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="哨兵机制">哨兵机制<a href="#哨兵机制" class="hash-link" aria-label="Direct link to 哨兵机制" title="Direct link to 哨兵机制">​</a></h3><p>在 Redis 主从集群中，哨兵（Sentinel）机制用于监测主节点的健康状况，并在主节点发生故障时进行自动故障转移。</p><p>哨兵是一个独立的进程，它与主从节点进行通信，并监测主节点的心跳信息。如果哨兵监测到主节点发生故障，它会根据一定的规则选择一个从节点，并将其提升为主节点，以确保缓存系统的正常运行。</p><p>具体来说，哨兵机制包括以下几个步骤：</p><ol><li>监测主节点：哨兵进程会定期向主节点发送心跳信息，以监测主节点的健康状况。如果主节点在一定时间内没有响应心跳信息，哨兵会将其标记为疑似故障。</li><li>确认主节点故障：当哨兵监测到主节点疑似故障时，它会向其他哨兵进程发送请求，以确认主节点是否真的发生故障。如果大多数哨兵都确认主节点故障，那么哨兵会将主节点标记为已故障。</li><li>选择从节点：在确认主节点故障后，哨兵会根据一定的规则选择一个从节点。通常，哨兵会选择与主节点最近一次同步数据的从节点。</li><li>提升从节点为主节点：哨兵会向选中的从节点发送命令，将其提升为主节点。然后，哨兵会向其他从节点发送命令，让它们开始复制新的主节点的数据。</li><li>通知客户端：当主节点发生故障并进行故障转移后，哨兵会向客户端发送通知，让它们更新连接到新的主节点。</li></ol><p>通过哨兵机制，Redis 主从集群可以实现自动故障转移，提高了缓存系统的可用性和可靠性。同时，哨兵机制还提供了监控和通知功能，方便管理员对集群进行管理和维护。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="选主打分">选主打分<a href="#选主打分" class="hash-link" aria-label="Direct link to 选主打分" title="Direct link to 选主打分">​</a></h4><ol><li>从库优先级</li><li>从库复制进度</li><li>从库ID</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么至少需要三个哨兵">为什么至少需要三个哨兵<a href="#为什么至少需要三个哨兵" class="hash-link" aria-label="Direct link to 为什么至少需要三个哨兵" title="Direct link to 为什么至少需要三个哨兵">​</a></h3><p>在 Redis Sentinel 中，至少需要三个 Sentinel 节点才能保证高可用性。</p><p>这是因为 Sentinel 节点之间需要通过选举算法选举出一个领导者，领导者负责执行故障转移操作。如果只有两个 Sentinel 节点，那么在选举过程中可能会出现分歧，导致无法选举出领导者，从而无法进行故障转移。</p><p>因此，为了避免这种情况的发生，至少需要三个 Sentinel 节点。这样，在选举过程中，至少有一个 Sentinel 节点会得到多数选票，从而选举出领导者，保证故障转移的顺利进行。</p><p>当然，为了进一步提高 Sentinel 系统的可靠性，通常建议使用更多的 Sentinel 节点。这样可以提高 Sentinel 系统的容错能力，避免单个 Sentinel 节点故障导致整个 Sentinel 系统不可用的情况。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="切片集群">切片集群<a href="#切片集群" class="hash-link" aria-label="Direct link to 切片集群" title="Direct link to 切片集群">​</a></h3><p>Redis 切片集群：是一种分布式存储解决方案，它将数据分散存储在多个 Redis 实例中，每个实例负责存储一部分数据。切片集群通过哈希槽（Hash Slot）的机制来分配数据。</p><p>在切片集群中，数据被划分为多个哈希槽，每个 Redis 实例都被分配了一定数量的哈希槽。当客户端要存储或获取数据时，会根据键的哈希值来确定应该将数据存储在哪个 Redis 实例的哈希槽中。</p><p>切片集群提供了水平扩展和负载均衡的能力，可以通过增加 Redis 实例的数量来增加缓存系统的容量和性能。同时，切片集群还提供了主从复制和故障转移功能，以确保数据的高可用性。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一致性哈希">一致性哈希<a href="#一致性哈希" class="hash-link" aria-label="Direct link to 一致性哈希" title="Direct link to 一致性哈希">​</a></h3><p>2^32-1 个哈希槽。</p><br><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="进阶">进阶<a href="#进阶" class="hash-link" aria-label="Direct link to 进阶" title="Direct link to 进阶">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis的哨兵sentinel是用来做什么的它如何确保高可用性">Redis的哨兵（Sentinel）是用来做什么的？它如何确保高可用性？<a href="#redis的哨兵sentinel是用来做什么的它如何确保高可用性" class="hash-link" aria-label="Direct link to Redis的哨兵（Sentinel）是用来做什么的？它如何确保高可用性？" title="Direct link to Redis的哨兵（Sentinel）是用来做什么的？它如何确保高可用性？">​</a></h3><p>Redis Sentinel是用于监控和管理Redis主从复制集群的工具，可以自动故障转移主服务器。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是redis-pipeline和事务有什么区别">什么是Redis Pipeline，和事务有什么区别？<a href="#什么是redis-pipeline和事务有什么区别" class="hash-link" aria-label="Direct link to 什么是Redis Pipeline，和事务有什么区别？" title="Direct link to 什么是Redis Pipeline，和事务有什么区别？">​</a></h3><p>Redis Pipeline允许一次性发送多个命令，减少了通信开销，提高了性能，特别是在批量操作时。
其中，Redis Pipeline不是原子操作，执行失败不会回滚。而事务是原子操作，执行失败会回滚。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是redis事务如何保证事务的一致性">什么是Redis事务？如何保证事务的一致性？<a href="#什么是redis事务如何保证事务的一致性" class="hash-link" aria-label="Direct link to 什么是Redis事务？如何保证事务的一致性？" title="Direct link to 什么是Redis事务？如何保证事务的一致性？">​</a></h3><p>Redis事务是一组命令，可以按顺序执行。
通过MULTI和EXEC命令，可以保证事务的原子性，要么全部执行成功，要么全部失败。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请介绍下redis-watch机制">请介绍下Redis Watch机制<a href="#请介绍下redis-watch机制" class="hash-link" aria-label="Direct link to 请介绍下Redis Watch机制" title="Direct link to 请介绍下Redis Watch机制">​</a></h3><p>Redis的乐观锁机制是通过WATCH命令来实现的，用于在事务中实现并发控制。</p><p>WATCH命令用于监视一个或多个键，一旦对这些键的值发生更改，与这些键相关的事务将被取消。
通常WATCH配合事务（MUTIL/EXEC）执行。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis事务和lua脚本有什么区别">Redis事务和Lua脚本有什么区别？<a href="#redis事务和lua脚本有什么区别" class="hash-link" aria-label="Direct link to Redis事务和Lua脚本有什么区别？" title="Direct link to Redis事务和Lua脚本有什么区别？">​</a></h3><p>Redis事务和Lua脚本都涉及原子性操作，要么全部成功，要么全部失败。除此之外：</p><ul><li>Redis事务是一组Redis命令的集合，按顺序执行</li><li>Lua脚本是在Redis中执行的Lua编程语言脚本，支持条件控制、循环、业务逻辑等复杂命令的组合</li></ul><br><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="实战">实战<a href="#实战" class="hash-link" aria-label="Direct link to 实战" title="Direct link to 实战">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="乐观锁watch">乐观锁（WATCH）<a href="#乐观锁watch" class="hash-link" aria-label="Direct link to 乐观锁（WATCH）" title="Direct link to 乐观锁（WATCH）">​</a></h3><p>WATCH 命令用于在执行修改操作之前监视一个或多个数据键。</p><p>它提供了一种乐观锁机制，允许客户端在执行某些操作之前先获取键的当前值，并在操作期间监视这些键的值是否发生了变化。</p><p>当客户端使用 WATCH 命令监视一个或多个键时，Redis 会将这些键的监视信息保存在一个内部队列中。当客户端执行某些操作（例如 GET、SET、DEL 等）时，Redis 会检查这些键是否被其他客户端修改过。如果键的值在客户端执行操作之前发生了变化，Redis 会返回一个错误，提示客户端需要重新获取键的最新值并再次尝试执行操作。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 创建 Redis 连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">redis_client </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Redis</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">host</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;localhost&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> port</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">6379</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> db</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 监视计数器的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">redis_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">watch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;counter&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取计数器的当前值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">counter_value </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> redis_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;counter&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 将计数器的值增加 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">new_counter_value </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> counter_value </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    redis_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;counter&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> new_counter_value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">except</span><span class="token plain"> redis</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exceptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WatchError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 处理 WATCH 错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">raise</span><span class="token plain"> Excepion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;WATCH 监视的数据发生了变化，需要重新获取最新值并再次尝试执行操作&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 输出结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;计数器的值更新为:&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> new_counter_value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">finally</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    redis_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">unwatch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分布式锁">分布式锁<a href="#分布式锁" class="hash-link" aria-label="Direct link to 分布式锁" title="Direct link to 分布式锁">​</a></h3><p>分布式锁分为获取锁和释放锁两个部分。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取锁">获取锁<a href="#获取锁" class="hash-link" aria-label="Direct link to 获取锁" title="Direct link to 获取锁">​</a></h4><p>可以使用SET命令来获取锁，结合NX（如果不存在）和EX（设置过期时间）参数，确保锁的独占性和自动释放。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">获取锁</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SET lock_key my_unique_identifier NX EX </span><span class="token number" style="color:rgb(181, 206, 168)">30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="释放锁">释放锁<a href="#释放锁" class="hash-link" aria-label="Direct link to 释放锁" title="Direct link to 释放锁">​</a></h4><p>可以使用Lua脚本来释放锁</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">释放锁-Lua脚本</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> redis.call</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;GET&quot;</span><span class="token plain">, KEYS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">return</span><span class="token plain"> redis.call</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;DEL&quot;</span><span class="token plain">, KEYS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="如何避免redis阻塞">如何避免Redis阻塞<a href="#如何避免redis阻塞" class="hash-link" aria-label="Direct link to 如何避免Redis阻塞" title="Direct link to 如何避免Redis阻塞">​</a></h3><p>Redis 可能在多种场景下发生阻塞，主要的原因包括：</p><ol><li><p><strong>持久化操作：</strong> 当 Redis 执行持久化操作（如RDB快照或AOF文件重写）时，它可能会阻塞对数据库的正常读写操作。持久化操作可能会导致一些短暂的阻塞，具体取决于数据的大小和系统的性能。</p><ul><li><strong>避免方法：</strong> 可以通过合理配置持久化策略，选择合适的持久化方式（RDB或AOF）以及调整触发持久化的时机来减轻持久化操作对性能的影响。另外，可以考虑使用 Redis 的持久化异步化特性，如AOF的<code>fsync</code>选项，以减少阻塞时间。</li></ul></li><li><p><strong>主从同步：</strong> 当 Redis 配置了主从复制时，主节点与从节点之间的数据同步也可能导致阻塞。主节点在进行全量同步或部分重同步时，从节点可能会暂时阻塞。</p><ul><li><strong>避免方法：</strong> 可以通过合理设置复制选项，例如选择合适的复制缓冲区大小，避免在高峰期进行同步等来减轻主从同步对性能的影响。</li></ul></li><li><p><strong>慢查询：</strong> 当 Redis 执行慢查询时，可能会阻塞其他请求的执行。</p><ul><li>全量键值对查询</li><li>复杂的聚合计算</li><li>BigKey写入于删除</li><li>清空数据库</li><li><strong>避免方法：</strong> 定期检查慢查询日志，通过优化查询语句、使用索引等手段提高查询性能。此外，可以设置合适的超时时间，对于长时间运行的查询进行适当的限制。</li></ul></li><li><p><strong>内存压力：</strong> 当 Redis 的内存使用达到系统可用内存的上限时，系统可能会开始进行内存回收，这可能导致 Redis 在一段时间内被阻塞。</p><ul><li><strong>避免方法：</strong> 监控 Redis 的内存使用情况，合理设置内存策略，考虑在需要时使用分片或集群来扩展内存容量。</li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="切片集群数据倾斜">切片集群数据倾斜<a href="#切片集群数据倾斜" class="hash-link" aria-label="Direct link to 切片集群数据倾斜" title="Direct link to 切片集群数据倾斜">​</a></h3><p>造成原因及解决方案</p><ul><li>存在BigKey<ul><li>解决方案：使用更合适的数据结构，将BigKey拆成多个Key</li></ul></li><li>哈希槽分配不均匀<ul><li>解决方案：增加虚拟节点</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内存碎片">内存碎片<a href="#内存碎片" class="hash-link" aria-label="Direct link to 内存碎片" title="Direct link to 内存碎片">​</a></h3><p>频繁的增删改会造成内存碎片。我们可以通过 <code>info memory</code> 查看内存碎片指标</p><p>当指标大于1小于1.5时，整体影响还好，但指标大于1.5时，表示内存碎片率已经超过50%了。</p><p>解决方案：</p><ol><li>重启 redis</li><li>开启自动内存碎片清理</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="脑裂">脑裂<a href="#脑裂" class="hash-link" aria-label="Direct link to 脑裂" title="Direct link to 脑裂">​</a></h3><p>当主节点因网络问题，哨兵重新选主时。因为网络恢复，使得当前集群存在两个主节点。</p><p>危害：</p><ol><li>当旧主节点恢复时，客户端的数据仍然会往旧主节点写。</li><li>新主节点上线后，会将旧主节点转化为从节点，因此期间数据会丢失。</li></ol><p>解决方案：</p><ol><li>提升网络稳定性</li><li>定期备份数据</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-cell">redis-cell<a href="#redis-cell" class="hash-link" aria-label="Direct link to redis-cell" title="Direct link to redis-cell">​</a></h3><p>redis-cell是令牌桶的一种实现，默认redis是不支持的，需要在配置中加载该模块。</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">loadmodule /path/to/redis/modules/redis-cell.so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>CELL.SET</code>创建令牌桶，创建时需要指定桶大小和令牌补充速率。
和<code>CELL.AWAIT</code>指令可以消费令牌桶，需要指定消费令牌数量。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/czasg/docusaurus/edit/main/docs/office/interview-guide/8.redis.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docusaurus/docs/office/interview-guide/mysql"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MySQL 题库</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docusaurus/docs/office/interview-guide/rabbitmq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RabbitMQ 题库</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础概念" class="table-of-contents__link toc-highlight">基础概念</a><ul><li><a href="#为什么说redis是单线程服务" class="table-of-contents__link toc-highlight">为什么说redis是单线程服务</a></li><li><a href="#redis60为什么要引入多线程" class="table-of-contents__link toc-highlight">Redis6.0为什么要引入多线程</a></li><li><a href="#redis单线程为什么性能这么好" class="table-of-contents__link toc-highlight">Redis单线程为什么性能这么好</a></li><li><a href="#事件驱动模型" class="table-of-contents__link toc-highlight">事件驱动模型</a></li><li><a href="#io多路复用" class="table-of-contents__link toc-highlight">IO多路复用</a></li><li><a href="#redis数据类型" class="table-of-contents__link toc-highlight">Redis数据类型</a></li><li><a href="#哈希表底层原理" class="table-of-contents__link toc-highlight">哈希表底层原理</a></li><li><a href="#redis与memcached区别" class="table-of-contents__link toc-highlight">Redis与Memcached区别</a></li><li><a href="#内存淘汰策略" class="table-of-contents__link toc-highlight">内存淘汰策略</a></li><li><a href="#除了缓存还有那些应用场景" class="table-of-contents__link toc-highlight">除了缓存还有那些应用场景</a></li></ul></li><li><a href="#缓存" class="table-of-contents__link toc-highlight">缓存</a><ul><li><a href="#什么是缓存击穿缓存穿透缓存雪崩缓存预热" class="table-of-contents__link toc-highlight">什么是缓存击穿、缓存穿透、缓存雪崩、缓存预热</a></li></ul></li><li><a href="#持久化" class="table-of-contents__link toc-highlight">持久化</a><ul><li><a href="#aofappend-only-file" class="table-of-contents__link toc-highlight">AOF（Append-Only File）</a></li><li><a href="#rdbredis-database" class="table-of-contents__link toc-highlight">RDB（Redis DataBase）</a></li><li><a href="#如何选择合适的持久化方式" class="table-of-contents__link toc-highlight">如何选择合适的持久化方式</a></li></ul></li><li><a href="#集群" class="table-of-contents__link toc-highlight">集群</a><ul><li><a href="#主从集群" class="table-of-contents__link toc-highlight">主从集群</a></li><li><a href="#主从复制" class="table-of-contents__link toc-highlight">主从复制</a></li><li><a href="#哨兵机制" class="table-of-contents__link toc-highlight">哨兵机制</a></li><li><a href="#为什么至少需要三个哨兵" class="table-of-contents__link toc-highlight">为什么至少需要三个哨兵</a></li><li><a href="#切片集群" class="table-of-contents__link toc-highlight">切片集群</a></li><li><a href="#一致性哈希" class="table-of-contents__link toc-highlight">一致性哈希</a></li></ul></li><li><a href="#进阶" class="table-of-contents__link toc-highlight">进阶</a><ul><li><a href="#redis的哨兵sentinel是用来做什么的它如何确保高可用性" class="table-of-contents__link toc-highlight">Redis的哨兵（Sentinel）是用来做什么的？它如何确保高可用性？</a></li><li><a href="#什么是redis-pipeline和事务有什么区别" class="table-of-contents__link toc-highlight">什么是Redis Pipeline，和事务有什么区别？</a></li><li><a href="#什么是redis事务如何保证事务的一致性" class="table-of-contents__link toc-highlight">什么是Redis事务？如何保证事务的一致性？</a></li><li><a href="#请介绍下redis-watch机制" class="table-of-contents__link toc-highlight">请介绍下Redis Watch机制</a></li><li><a href="#redis事务和lua脚本有什么区别" class="table-of-contents__link toc-highlight">Redis事务和Lua脚本有什么区别？</a></li></ul></li><li><a href="#实战" class="table-of-contents__link toc-highlight">实战</a><ul><li><a href="#乐观锁watch" class="table-of-contents__link toc-highlight">乐观锁（WATCH）</a></li><li><a href="#分布式锁" class="table-of-contents__link toc-highlight">分布式锁</a></li><li><a href="#如何避免redis阻塞" class="table-of-contents__link toc-highlight">如何避免Redis阻塞</a></li><li><a href="#切片集群数据倾斜" class="table-of-contents__link toc-highlight">切片集群数据倾斜</a></li><li><a href="#内存碎片" class="table-of-contents__link toc-highlight">内存碎片</a></li><li><a href="#脑裂" class="table-of-contents__link toc-highlight">脑裂</a></li><li><a href="#redis-cell" class="table-of-contents__link toc-highlight">redis-cell</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Py开源项目</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/czasg/pywss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pywss<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/czasg/loggus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Loggus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Go开源项目</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/czasg/go-queue" target="_blank" rel="noopener noreferrer" class="footer__link-item">Go Queue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/czasg/go-env" target="_blank" rel="noopener noreferrer" class="footer__link-item">Go Env<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/czasg/go-set" target="_blank" rel="noopener noreferrer" class="footer__link-item">Go Set<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/czasg/gonal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gonal<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/czasg/snow" target="_blank" rel="noopener noreferrer" class="footer__link-item">Snow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">活跃社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/czasg" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.v2ex.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">V2EX<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">官方文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.python.org/zh-cn/3/library/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Py标准库<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Czasg's Site.</div></div></div></footer></div>
<script src="/docusaurus/assets/js/runtime~main.942897e7.js"></script>
<script src="/docusaurus/assets/js/main.73c56d5a.js"></script>
</body>
</html>