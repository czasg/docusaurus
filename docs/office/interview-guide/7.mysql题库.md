---
title: MySQL 题库
sidebar_label: MySQL 题库
slug: mysql
description: 收录MySQL常见面试题库
---

## 1.MySQL基础

### 数据库设计三大范式
数据库设计的三大范式是一组规范化的设计原则，用于帮助设计和组织数据库表以减少数据冗余和确保数据的一致性和完整性。

- 第一范式（1NF）：要求原子性
- 第二范式（2NF）：不允许部分依赖
- 第三范式（3NF）：不允许传递依赖

```sql title="不满足范式一，1和3不符合原子性"
| BookID | Title                  | Author                | PublicationDate | Publisher           |
|--------|------------------------|-----------------------|-----------------|---------------------|
| 1      | "The Great Gatsby"     | "F. Scott Fitzgerald" | 1925            | "Scribner"          |
| 2      | "Pride and Prejudice"  | "Jane Austen"         | 1813            | "Penguin Classics"  |
| 3      | "The Great Gatsby"     | "F. Scott Fitzgerald" | 1925            | "Scribner"          |
```

```sql title="不满足范式二，一般存在于联合主键场景，导致部分依赖"
| StudentID | CourseID | CourseName         | Teacher          |
|----------|----------|--------------------|-------------------|
| 1        | 101      | "Mathematics 101"  | "Mr. Smith"       |
| 1        | 102      | "Physics 101"      | "Ms. Johnson"     |
| 2        | 101      | "Mathematics 101"  | "Mr. Smith"       |
| 2        | 103      | "Chemistry 101"    | "Dr. Brown"       |
```

```sql title="不满足范式三，存在传递依赖，应该拆表"
| BookID | Title                  | Author                | PublicationDate | Publisher           |
|--------|------------------------|-----------------------|-----------------|---------------------|
| 1      | "The Great Gatsby"     | "F. Scott Fitzgerald" | 1925            | "Scribner"          |
| 2      | "Pride and Prejudice"  | "Jane Austen"         | 1813            | "Penguin Classics"  |
| 3      | "The Great Gatsby"     | "F. Scott Fitzgerald" | 1925            | "Scribner"          |
```

<br/>

---

## 2.MySQL存储引擎

### 介绍下常见的存储引擎
MySQL 是一个开源关系型数据库管理系统，支持多种不同的存储引擎。

存储引擎是 MySQL 用于管理数据的基础组件，它们负责处理 SQL 语句，包括读取和写入数据等操作。
常见的存储引擎有：

- InnoDB：InnoDB 是 MySQL 默认的存储引擎，它支持事务、外键和行级锁等特性。
- MyISAM：MyISAM 是 MySQL 最古老的存储引擎之一，不支持事务和行级锁，这也是它被 InnoDB 取代的很大一部分原因之一。
但它非常适合用于处理大量的读取操作，例如数据仓库和日志文件等。
- Memory：Memory 存储引擎将内存存储引擎，优点是速度非常快，缺点就是数据是非持久的。

---

### 介绍下InnoDB与MyISAM区别
InnoDB和MyISAM是两个常用的存储引擎，用于MySQL数据库管理系统，它们在功能、性能和适用场景上有一些重要的区别。以下是它们之间的主要区别：

1. **事务支持：**InnoDB支持事务（ACID属性），MyISAM不支持事务

2. **锁机制：**InnoDB使用行级锁（row-level locking），MyISAM使用表级锁（table-level locking）

3. **外键支持：**
    - InnoDB支持外键完整性约束，可以定义外键关系，确保数据的完整性。
    - MyISAM不支持外键，不能定义外键关系。

4. **崩溃恢复：**
    - InnoDB支持崩溃恢复，具有事务日志和事务回滚功能，可以更好地处理数据库崩溃时的数据完整性。
    - MyISAM不具备崩溃恢复功能，容易在崩溃时丢失数据。

6. **空间和性能：**
    - InnoDB通常需要更多的磁盘空间来存储数据，因为它维护额外的事务日志和索引结构。
    - MyISAM在一些情况下可能在性能上表现更好，特别是在只读操作较多的情况下。

<br/>

---

## 3.MySQL事务

### 什么是事务
事务是一组数据库操作的逻辑单元。这些操作要么全部成功，要么全部失败。因此它具有ACID属性：

1. **原子性（Atomicity）**：事务是原子的，意味着它要么完全执行，要么不执行。如果事务的任何部分失败，整个事务将被回滚，数据库将恢复到事务开始之前的状态，以确保数据的一致性。

2. **一致性（Consistency）**：事务的执行将数据库从一个一致状态转移到另一个一致状态。这意味着事务的执行不会破坏数据库的完整性约束或数据关系。

3. **隔离性（Isolation）**：每个事务应该在不受其他事务干扰的情况下执行，即使多个事务同时运行也不会相互干扰。这意味着事务之间应该是相互隔离的，以防止数据冲突。

4. **持久性（Durability）**：一旦事务成功提交，其结果应该是永久性的，并且在系统故障或重启后仍然保持。这要求数据库将事务的变更持久地保存在存储设备上，以确保数据的持久性。


---

### 事务隔离级别
MySQL 是一个关系型数据库管理系统，它支持多个事务之间的并发执行。因此需要保障事务之间的隔离性和数据一致性。

MySQL 提供了四个事务隔离级别，它们分别是：

- READ UNCOMMITTED（读未提交）：最低级别的隔离级别。事务可以读取另一个事务尚未提交的数据。在此隔离级别下，会存在脏读、不可重复读和幻读等问题。
- READ COMMITTED（读已提交）：默认的隔离级别。事务只能读取另一个已提交的事务的数据。在此隔离级别下，解决了脏读的问题，但仍然存在不可重复读、幻读的问题。
- REPEATABLE READ（可重复读）：事务开始时读取的数据集合将保持不变，即使其他事务对这些数据进行了修改或插入操作，也不会影响该事务。这种隔离级别解决了不可重复读的问题，但是仍然存在幻读问题。
- SERIALIZABLE（序列化）：最高级别的隔离级别，多个事务之间顺序执行。在此隔离级别下，事务之间不会存在冲突，但会牺牲性能。

<br/>

---

### 什么是脏读
当一个事务可以读取另一个事务尚未提交的数据，而另一个事务随后被回滚，那么当前事务读取到的数据就是无效的。

这类现象被称之为**脏读（Dirty read）**，因为它读到了脏数据。 

<br/>

---

### 什么是不可重复读
当一个事务，多次读取同一数据，但每次读取的结果都不同。

这种现象被称为**不可重复读（Non-repeatable read）**，因为无法重复读取相同的数据。

<br/>

---

### 什么是幻读

<br/>

---

## MySQL索引

### 你了解的索引种类
MySQL支持多种类型的索引，以提高查询性能和加速数据检索。以下是一些常见的MySQL索引类型：

1. **B-树索引（B-Tree Index）：** B-树索引是最常见的索引类型，在大多数情况下都可以满足需求。它适用于精确匹配和范围查询。B-树索引适用于整数、字符、日期等数据类型。

2. **哈希索引（Hash Index）：** 哈希索引将索引键的值经过哈希函数计算后存储在索引中，用于加速等值查询。它对于等值查询非常高效，但不支持范围查询或排序操作。哈希索引适用于大多数数据类型，但特别适合于高基数列。

3. **全文索引（Full-Text Index）：** 全文索引用于对文本数据进行全文搜索。它允许模糊匹配、词干搜索和布尔搜索。全文索引适用于TEXT和VARCHAR列。

4. **空间索引（Spatial Index）：** 空间索引用于处理地理信息系统（GIS）数据，如地理坐标、多边形等。它可以加速地理空间查询，如点在多边形内的查询。

5. **前缀索引（Prefix Index）：** 前缀索引是对列值的前缀进行索引，而不是整个值。它可以用于节省索引存储空间和加速检索。前缀索引适用于较长的字符串列。

6. **复合索引（Composite Index）：** 复合索引是包含多个列的索引。它可以用于加速多列查询，但要注意索引顺序和查询条件的匹配性，以确保性能提升。

7. **唯一索引（Unique Index）：** 唯一索引要求索引列的值在表中是唯一的，用于强制数据的唯一性。它适用于任何数据类型。

8. **主键索引（Primary Key Index）：** 主键索引是唯一索引的一种，通常用于标识表中的每一行。它确保每行都具有唯一的主键值。

9. **外键索引（Foreign Key Index）：** 外键索引用于连接不同表格之间的关系。它通常与外键约束一起使用，以确保数据完整性。

10. **全局索引（Clustered Index）：** 全局索引用于InnoDB存储引擎，它决定了数据行在表中的物理存储顺序。每个InnoDB表只能有一个全局索引。

---

### 如何理解块索引
通常来说，块索引（Block Index）不是一个独立的索引类型，而是一个较低级别的概念，
用于描述数据库引擎内部索引结构的存储方式。

但在PostgreSQL中，块索引是一个高级特性。
它通常用于特定类型的应用场景，特别是那些需要处理大量块级别数据的场景，例如时间序列数据库或列式数据库。
它支持以下特性：

1. **范围查询（Range Queries）**：块索引可用于支持范围查询，例如查找某个范围内的数据块。这对于处理时间序列数据等应用非常有用。

2. **块级别的检索**：块索引直接在数据块级别存储索引信息，从而可以加速块级别的检索，而不是单个行级别的检索。

3. **块合并和块分割**：块索引对于块合并（Block Merging）和块分割（Block Splitting）等操作非常高效，这些操作通常用于数据块的管理。

---

### 主键和外键的区别
主键可以作为每一行数据的唯一性标识。
外键则是用于维护数据完整性和建立表格之间关系的一种强约束。

### 最左前缀原则

### 无法命中索引的情况

### 读写分离和分库分表

### char和varchar区别
- CHAR 是一种固定长度的字符数据类型
- VARCHAR 是一种可变长度的字符数据类型

<br/>

---

## MySQL架构

### 一条SQL的执行过程
在 MySQL 中，一条完整 SQL 的执行过程大致是：

- 建立连接：MySQL 连接器负责建立用户连接，包括初始化用户权限等基础信息。
- 查询缓存：对于已经存在缓存的查询语句，MySQL 会直接返回缓存结果。
- 语法分析：MySQL 会对 SQL 进行解析并检查是否存在语法错误。
- 查询优化：一条 SQL 的执行策略是多样的，比如可以走全表扫描，或者走某个索引等。
此处的查询优化就是根据表的大小、索引等信息，再结合 SQL 的查询条件，综合选择最优查询方案。
- 执行语句：MySQL 的数据操作是基于存储引擎实现的。此处的执行是调用存储引擎接口实现。





<br/>

---

## 优化场景

### 索引优化


<br/>

---


## 运维场景

### 选错索引

---

### 无法命中索引
- 索引字段使用了函数：因为函数会破坏索引的有序性，从而导致全表扫描。
- 隐式类型转化：比如查询字段为字符串，但实际查询条件使用的数字，这会导致在实际查询过程中的执行类型转化。
- 隐式编码转化：当两张表使用了不同类型的编码时，实际查询过程中会执行编码类型转化。

---

### 单次查询很慢
- 无索引：走全表扫描
- 有索引：
  - 没有正确命中索引
  - 索引体积过大
- 存在脏页，数据库需要先刷脏页

---

### 性能定期抖动

---

### count(*)会扫描全表

---

### 删除表后空间不变

<br/>

---

## 名词解释

### 脏页

### 主备延迟

---

