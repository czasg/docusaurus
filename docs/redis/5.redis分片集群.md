---
title: redis 分片集群
sidebar_label: redis分片集群
---

当 redis 需要存储大量数据，我们往往由两种考虑方案：   
1、纵向拓展：增加单机配置。  
2、横向拓展：分片集群。   

本文针对这两种方案进行讨论和对比。

## 纵向拓展
纵向拓展就是增加单机配置，这应该是最简单的方案了。比如 2g 内存升级到 4g 内存，然后还有 8g、16g、32g 等。

一般来讲，如果 8g 能满足需求，那可以直接选择此方案。但是如果需要更大的内存，那可能需要考虑性能方面的问题了，特别是持久化方面。    
比如主线程 fork 创建子进程时，如果内存使用足够大，则创建子进程时需要拷贝的资源就更多，阻塞的时间也更久。


## 横向拓展
横向拓展就是使用多个 redis 才存储数据并提供服务，这样把一个大的内存实例，拆分到多个小内存实例。问题就是如何管理这些实例了。

redis 支持切片集群，可以很好的管理多个 redis 实例之间的数据。   
原理是采用哈希槽，来处理数据和实例之间的映射关系。一个切片集群中，有 2**14 = 16384 个哈希槽。
每一个键值对都会被映射到这些哈希槽中。而哈希槽又映射到 redis 实例。    
具体的映射方法为：对 key 进行 crc16 计算，然后对 16384 取模即可。   
而且集群中任何一个实例都可以查询到数据，这归结于重定向机制，即计算出哈希槽不属于自己时，会重定向到目标实例并执行操作。

