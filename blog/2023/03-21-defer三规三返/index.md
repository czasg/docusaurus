---
title: deferå‘ç‚¹æ”¶å½•
authors: [czasg]
tags: [golang]
---

Go defer å²è¯—çº§å‘ç‚¹æ•´ç†ï¼

<!--truncate-->

### å…¥å‚æ˜¯ç¡®å®šçš„
```go
func demo() {
    i := 1
    defer fmt.Println(i) // è¾“å‡º1
    i++
    return i
}
```
å…¥å‚åœ¨ defer å‡ºç°æ—¶åˆ»å·²ç»ç¡®å®šï¼Œå› ä¸ºæ‰§è¡Œ `defer fmt.Println(i)` æ—¶å·²ç»ç”Ÿæˆä¸´æ—¶å˜é‡æ‹·è´äº†ä¸€ä»½å‚æ•°ã€‚

### åè¿‘å…ˆå¤„
è¿™ä¸ªé€šå¸¸æ²¡æœ‰é—®é¢˜ï¼Œå³åé¢å®šä¹‰çš„ defer ä¼šå…ˆæ‰§è¡Œï¼Œå¾ˆå¥½ç†è§£ã€‚

### å¯æ“ä½œå…·åå‚æ•°è¿”å›
```go
func demo() (result int) {
    i := 1
    defer func() {
        result++ // demoå‡½æ•°è¿”å›å€¼ä¸º2
    }
    return i
}
```
æ­¤å¤„å‡½æ•° return å®é™…å¯ä»¥æ‹†è§£ä¸ºä¸¤æ­¥ï¼Œå³ï¼š
```go
result = i
return
```
æ•… defer ä¼šä¿®æ”¹æ­¤å¤„å®é™…è¿”å›å€¼ã€‚

### ä¸å¯æ“ä½œéå…·åè¿”å›
åŒæ ·çš„å‡½æ•°æˆ‘ä»¬ä½œä¸‹é€‚å½“çš„è°ƒæ•´
```go
func demo() int {
    i := 1
    defer func() {
        i++ // demoå‡½æ•°è¿”å›å€¼ä¸º1
    }
    return i
}
```
åœ¨æ‰§è¡Œ return çš„æ—¶å€™ï¼Œå·²ç»ç”Ÿæˆä¸´æ—¶å˜é‡å­˜å‚¨è¿”å›å€¼ï¼Œæ•…å»¶è¿Ÿå‡½æ•° defer æ— æ³•å¯¹è¿”å›å€¼åšå‡ºä¿®æ”¹ã€‚

<br/>

:::info ğŸ‘‡ğŸ‘‡ğŸ‘‡
**æœ¬æ–‡ä½œè€…:** Czasg    
**ç‰ˆæƒå£°æ˜:** è½¬è½½è¯·æ³¨æ˜å‡ºå¤„å“¦~ğŸ‘®â€
:::
