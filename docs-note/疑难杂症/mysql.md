## 用户建立连接后，权限是否能被修改？
用户的权限校验，是在连接建立时进行的。   
对于已建立连接的用户，是不生效的。

---

## mysql 过多长连接导致内存过大？
mysql 在执行过程中，临时使用的内存是管理在连接对象中的。这些资源只有在连接断开时才会被释放。    
如果长连接积累过多，会导致内存占用过多，最终 OOM，从现象看就是 mysql 异常重启了。

针对这种问题，我们可以考虑两种方案：   
1、定期断开长连接，可以设置最大存活时间。     
2、如果是 mysql5.7 及以上版本，可以执行 mysql_reset_connection 来重置和初始化连接资源。    

---

## 什么是事务？
我们知道的比较多的就是数据库事务。   
他是对一批待执行命令的简称，这批命令要么全部执行，要么全部不执行。    

---

## MyISAM 和 InnoDB 对比如何？
1、InnoDB 支持事务，而 MyISAM 不支持事务。特别是再数据库全量备份时，如果不支持事务，那么数据库不得不上全局锁以保证数据正确备份。     
2、InnoDB 基于 WAL 机制，提供 crash-safe 保障数据不丢失    
3、InnoDB 支持行锁，而 MyISAM 不支持。所以在并发支持上 InnoDB 更佳。

---

## 为什么不建议使用长事务？
数据库由于多版本并发控制，在事务执行期间，会生成版本视图。当事务存在的时间越久，那么系统中就会存在越多的历史视图。  
因为事务是需要可回滚，在长事务结束前都不能释放这些历史记录，这回导致占用大量的存储空间。

---

## 如何减少数据库回表？
以 B+树 索引为例，存在两类索引，一种时主键索引，一种是普通索引。   
主键索引的叶子节点存储的是整行数据，而普通索引叶子节点存储的是主键索引的值。

而回表就是查询普通索引获取主键索引的值，然后再通过主键值去主键索引再次搜索的过程。  
回表会大大降低数据库的性能。

常见的减少数据库回表的措施有：   
1、覆盖索引：普通索引中的信息已经满足查询条件时，则不会再回表查询。常见的有查询主键ID，或者联合索引中存在待查询字段。         
2、索引下推：索引查询时会有心啊过滤掉不满足条件的索引，以此减少回表次数。   

---

## 如何对一个热点表进行 alter？
因为读表时会默认加上 MDL 读锁，而 alter 会修改表结构，会默认加上 MDL 写锁。他们二者冲突。在热点表上更有可能造成事故。    
一般建议对 alter 加上等待时间，在等待时间里如何能拿到最好，拿不到也不会阻塞其他线程。

---

## 热点行更新导致的性能问题？
针对热点行更新导致的性能问题，一般是死锁检测导致的。一般建议是降低并发度。

---

## 事务启动时视图是如何生成的？
事务启动时会申请唯一的事务ID，这是实现MVCC多版本管理的关键。

以可重复读事务隔离级别为例。在数据库中，每一行数据都存在多个版本。   
每次事务更新数据时，也都会生成一个新的数据版本，并将当前事务ID作为版本号。   
在同一行中，多个事务之间形成一条链式的关系。
